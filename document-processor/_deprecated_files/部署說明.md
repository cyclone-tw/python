# 公文智能處理系統 - 部署說明

## 📦 系統需求

### 環境要求
- **作業系統**：Windows 10/11
- **Python 版本**：3.8 或以上
- **硬碟空間**：至少 1GB 可用空間
- **網路連線**：穩定的網際網路連線

### 必要權限
- Google Drive 讀寫權限
- Google Calendar API 存取權限
- Google Tasks API 存取權限

## 🔧 安裝步驟

### 1. 安裝 Python 套件
```bash
cd "C:\Users\Admin\Claude.ai\Python-公文智能處理系統"
pip install -r requirements.txt
```

### 2. 設定 Gemini API

#### 取得 API 金鑰
1. 前往 [Google AI Studio](https://aistudio.google.com/)
2. 登入 Google 帳號
3. 點選「Get API key」
4. 建立新的 API 金鑰
5. 複製金鑰

#### 修改設定檔
編輯 `config.py` 檔案：
```python
'gemini': {
    'api_key': '你的_Gemini_API_金鑰',  # 替換這裡
    'model': 'gemini-1.5-flash',
    'temperature': 0.2,
    'max_tokens': 2048,
    'timeout': 30
},
```

### 3. 設定 Google API 認證

#### 建立 Google Cloud 專案
1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 建立新專案或選擇現有專案
3. 啟用以下 API：
   - Google Calendar API
   - Google Tasks API

#### 建立認證檔案
1. 在 Google Cloud Console 中，前往「APIs & Services」>「Credentials」
2. 點選「Create Credentials」>「OAuth 2.0 Client IDs」
3. 應用程式類型選擇「Desktop application」
4. 下載 JSON 檔案
5. 將檔案重新命名為 `credentials.json`
6. 放置在專案根目錄

#### 設定授權範圍
系統會自動處理首次授權流程，授權範圍包括：
- `https://www.googleapis.com/auth/calendar` - Google Calendar 存取
- `https://www.googleapis.com/auth/tasks` - Google Tasks 存取

### 4. 設定目錄路徑

編輯 `config.py` 檔案中的路徑設定：
```python
'paths': {
    'scan_directory': r"G:\我的雲端硬碟\00.Inbox",        # 掃描目錄
    'target_directory': r"G:\我的雲端硬碟\01.公文智能歸檔", # 歸檔目錄
    'credentials': 'credentials.json',
    'token': 'token.pickle'
},
```

### 5. 測試安裝

執行測試指令：
```bash
python config.py
```

如果看到「✅ 設定檢查通過！」表示安裝成功。

## 🔑 API 和授權設定

### 如何更改 Gemini API 金鑰

1. **取得新的 API 金鑰**
   - 前往 [Google AI Studio](https://aistudio.google.com/)
   - 建立或選擇現有專案
   - 產生新的 API 金鑰

2. **修改設定檔**
   ```python
   # 編輯 config.py
   'gemini': {
       'api_key': '新的_API_金鑰',  # 在這裡更新
       # 其他設定保持不變
   }
   ```

3. **重新啟動系統**

### 如何更改 Google 授權帳號

#### 方法 1：重新授權（推薦）
1. **刪除現有 token**
   ```bash
   del token.pickle
   ```

2. **重新執行系統**
   ```bash
   python main.py
   ```

3. **完成新的授權流程**
   - 系統會自動開啟瀏覽器
   - 選擇新的 Google 帳號
   - 授權存取 Calendar 和 Tasks

#### 方法 2：更換 credentials.json
1. **使用新 Google 帳號建立專案**
   - 前往 [Google Cloud Console](https://console.cloud.google.com/)
   - 使用新帳號登入
   - 建立新專案並啟用相關 API

2. **下載新的認證檔案**
   - 建立新的 OAuth 2.0 認證
   - 下載 JSON 檔案
   - 替換現有的 `credentials.json`

3. **清除舊的授權記錄**
   ```bash
   del token.pickle
   ```

4. **重新執行系統進行授權**

### 如何更改目錄路徑

編輯 `config.py` 檔案：
```python
'paths': {
    'scan_directory': r"新的掃描目錄路徑",      # 例如：D:\Documents\Inbox
    'target_directory': r"新的歸檔目錄路徑",    # 例如：D:\Documents\Archive
    'credentials': 'credentials.json',
    'token': 'token.pickle'
},
```

## 🔍 驗證設定

### 檢查 Gemini API
```bash
python -c "from modules.gemini_analyzer import GeminiSmartAnalyzer; print('Gemini API 正常' if GeminiSmartAnalyzer().test_connection() else 'Gemini API 異常')"
```

### 檢查 Google API
```bash
python -c "from modules.google_integration import GoogleIntegration; print('Google API 正常' if GoogleIntegration().test_connection()['success'] else 'Google API 異常')"
```

### 檢查目錄權限
```bash
python -c "from pathlib import Path; print('目錄權限正常' if Path('G:/我的雲端硬碟/00.Inbox').exists() else '請檢查目錄路徑')"
```

## ⚠️ 常見問題

### 1. Gemini API 錯誤
- **問題**：API 金鑰無效
- **解決**：檢查 API 金鑰是否正確，確認帳號有足夠的配額

### 2. Google 授權失敗
- **問題**：OAuth 認證失敗
- **解決**：
  1. 確認 `credentials.json` 檔案正確
  2. 檢查 Google Cloud 專案是否啟用相關 API
  3. 刪除 `token.pickle` 重新授權

### 3. 目錄存取錯誤
- **問題**：無法存取指定目錄
- **解決**：
  1. 檢查目錄路徑是否正確
  2. 確認有讀寫權限
  3. 檢查 Google Drive 同步狀態

### 4. Unicode 編碼錯誤
- **問題**：Windows 終端機顯示亂碼
- **解決**：
  1. 使用 UTF-8 支援的終端機
  2. 設定環境變數：`set PYTHONIOENCODING=utf-8`

## 🔄 系統更新

### 更新步驟
1. 備份現有設定檔 `config.py`
2. 下載新版本程式碼
3. 恢復設定檔
4. 檢查是否有新的套件需求
5. 執行測試驗證

### 備份重要檔案
- `config.py` - 系統設定
- `credentials.json` - Google 認證
- `token.pickle` - 授權記錄

## 📞 技術支援

如需協助，請提供：
1. 錯誤訊息截圖
2. `error.txt` 檔案內容
3. 作業系統版本
4. Python 版本資訊